
## üõ°Ô∏è IAM
#### 1. Introduction to IAM
- IAM (Identity and Access Management) is a web service that helps securely control access to AWS resources.
- IAM enables authentication (who you are) and authorization (what you can do).
- It is global‚Äînot region-specific.

#### 2. IAM Identities
‚û§ IAM Users
- Represents a single person or service.
- Assigned credentials:
  - Username/password for AWS Console
  - Access keys for CLI/SDK/API
- Can be assigned permissions via policies.

‚û§ IAM Groups
- Collection of IAM users.
- Policies attached to groups are inherited by users.
- Best practice: Assign permissions to groups, not users.

‚û§ IAM Roles
- Temporary credentials.
- Used for:
  - AWS services (e.g., EC2, Lambda)
  - Cross-account access
- Federated identities (SSO, external IdPs)
- Assume roles using AWS STS.

‚û§ IAM Policies
- JSON documents that define permissions.
- Can be:
  - AWS-managed
  - Customer-managed
  - Inline (directly embedded)

#### 3. IAM Policies
‚û§ Structure of a Policy
```
{
  "Version": "2012-10-17",
  "Statement": [{
    "Effect": "Allow" | "Deny",
    "Action": "s3:PutObject",
    "Resource": "arn:aws:s3:::my-bucket/*",
    "Condition": {
      "StringEquals": {
        "aws:username": "john"
      }
    }
  }]
}
```
- Version: Policy language version
- Statement: One or more individual permissions
- Effect: `Allow` or `Deny`
- Action: What actions are allowed (e.g., `s3:ListBucket`)
- Resource: Which resource the action applies to

‚û§ Types of Policies
- Identity-based policies ‚Äì attached to users, groups, roles
- Resource-based policies ‚Äì attached to resources like S3, Lambda
- Permissions boundaries ‚Äì maximum permission limit
- Service control policies (SCPs) ‚Äì for AWS Organizations
- Session policies ‚Äì passed when assuming a role

‚û§ Evaluation Logic
- Deny always overrides Allow.
- If there‚Äôs no explicit Allow, access is implicitly denied.
- Conditions further refine access control.

#### 4. IAM Best Practices
- Use MFA for the root account and all users.
- Never use root account for daily tasks.
- Grant least privilege.
- Regularly rotate credentials.
- Use roles instead of long-term credentials (especially for EC2).
- Monitor with CloudTrail and Config.

#### 5. IAM Roles and Use Cases
‚û§ Use Cases
- EC2 instance accessing S3
- Lambda writing logs to CloudWatch
- Cross-account access (Account A assumes a role in Account B)
- Third-party applications (temporary credentials via STS)

‚û§ Role Trust Policy (Who can assume the role)
```
{
  "Effect": "Allow",
  "Principal": {
    "Service": "ec2.amazonaws.com"
  },
  "Action": "sts:AssumeRole"
}
```
#### 6. Permissions Boundaries
- Advanced feature to limit the maximum permissions an identity can have.
- Does not grant permissions, only restricts them.
- Useful for delegating permission management safely.

#### 7. IAM Access Analyzer
- Helps identify resources shared with external accounts or organizations.
- Generates findings if a policy allows unintended access.
- Good for auditing and compliance.
- Works with:
  - S3
  - IAM roles and policies
  - Lambda
  - KMS
  - SQS, SNS

#### 8. IAM Policy Conditions
‚û§ Common Condition Keys
- `aws:CurrentTime`
- `aws:SourceIp`
- `aws:username`
- `aws:MultiFactorAuthPresent`
- `s3:prefix`, `s3:x-amz-server-side-encryption`

‚û§ Example: Restrict access by IP
```
"Condition": {
  "IpAddress": {
    "aws:SourceIp": "203.0.113.0/24"
  }
}
```
#### 9. IAM Policy Simulator
- Tool to test and troubleshoot IAM policies.
- Simulates API calls to verify permissions.
- Can test:
  - User permissions
  - Role assumptions
  - Resource policies

#### 10. Logging and Monitoring IAM
‚û§ AWS CloudTrail
- Logs all IAM and STS API activity.
- Useful for auditing and compliance.

‚û§ AWS Config
- Tracks changes to IAM resources.
- Can create rules (e.g., check if MFA is enabled).

‚û§ AWS CloudWatch
- Set up alarms for suspicious IAM activity.
- Monitor login attempts, unauthorized access, etc.

#### 11. IAM and AWS Organizations
‚û§ Service Control Policies (SCPs)
- Set permission boundaries at the account or organizational unit (OU) level.
- Can‚Äôt grant permissions‚Äîonly restrict.
- Applied in addition to IAM policies.

‚û§ Use Cases
- Prevent use of specific services (e.g., deny EC2 in dev accounts)
- Force tagging requirements
- Centralize access control
